# 计算机网络Chapter1

### 什么是互联网

##### 组成

主机（hosts），也叫端系统（end system）

- 运行程序的
- 例如手机，电器等

端系统通过通信链路（communication links）和分组交换机（packet switch）连在一起

- 通信链路（communication links）
  - 使用物理介质进行传递
  - 光纤，铜线，无线电频谱等
  - 传输速率：bandwidth，单位：bps
  - 通过分组进行传递
- 分组交换机
  - 接收包，传送包
  - 路由器（router），链路层交换机（link-layer switch）

端系统通过ISP接入因特网

- 因特网服务提供商（Internet service providers）
  - 将各个端系统连在一起

协议（protocols）

- 控制信息的接收和发送
- TCP，IP

因特网标准（Internet standards）

- 标准的协议
- RFC，IETF

##### 定义

网络的网络（network of networks）

给应用程序提供服务

给应用程序提供编程接口：socket

### 什么是协议

定义了消息传送的方式和顺序，以及报文发送/接收所采取的动作

关键词：**messages, actions**

### 网络结构

网络边缘（network edge）

- 主机（host）=端系统（end system）
- client/server model
  - 要求服务器永远在工作
- peer-peer model
  - require high bandwith

- 主机：客户（client），服务器（servers）
- 接入网（access networks）
  - 将端系统连接到边缘路由器（edge router）的物理链路
  - 家庭接入：DSL，电缆，光纤到户（FTTH），拨号和卫星
  - 企业接入：以太网和WiFi
  - 广域无线接入：3G，LTE
- 物理媒体：引导型媒体（guided media），非引导型媒体（unguided media）

网络核心（network core）

- 分组交换

  - 将大的报文分成较小的数据块，进行传输

  - 通信之前不需要建立连接

  - 每个分组通过通信链路和分组交换机进行传输

  - 存储转发传输（store-and-forward transimission）

    - 分组交换机只进行报文的传递和转发
  
    - 假设包大小为L，传输速率为R，则延迟为
      $$
      \frac{L(\text { bits })}{R(\text { bits } / \text { sec})}
      $$
  
  - 排队时延（sequence delay）和分组丢失（loss）
  
    - 当交换机的包满了就丢包了
  
  - 转发表（forwarding table）和路由选择协议
  
    - 转发表解决的是路由器传送方向的问题
      - 路由器使用端系统的IP地址进行转发
      - 由IP地址的等级结构，路由器通过转发表找到IP地址的下一个最近的路由器，从而进行转发
    - 通过路由选择协议制定转发表
  
- 电路交换

  - 通信期间预留资源，而分组交换不预留
  - 使用频分复用技术（Frequency-Division Multiplexing）或者时分复用技术（Time-Division Multiplexing）来实现
    - 对于TDM，时间被分成固定区间的帧，每个帧之间分成固定数量的时隙。当一条链路建立连接之后，网络会在每个帧中为该链接指定一个时隙
      - 仅仅是指定一个时隙，如果有空余的时隙，也不会进行占用
    - 对于FDM，其频率域被分成若干频段。当连接建立时频段被占用
  - 在静默期（silent period）没有资源空余，效率很低
  - 保留的资源，所以通信质量得到了保证
  - 在信息交换之前，需要建立连接

对于数据交换，要么是电路交换，要么分组交换

### 分组交换网中的时延、丢包和吞吐量

#### 结点总时延（total nodal delay）

- 结点处理时延（nodal processing delay）
  - 检查分组头部和决定该分组该导向何处
  - 结点处理后，路由器将该分组导向其他路由器链路之前的队列

- 排队时延（queuing delay）
  - 指分组在链路上等待传输时发生的时延
  - 和队列的流量的强度和性质相关
- 传输时延（transmission delay）
  - 将包传输到另外一个路由器的时延
  - 仅当所有一定到达的分组被传输后，才能传输刚到达的分组
  - 是路由器将分组推出所需要的时间
  - 是分组长度和链路传输速率的函数
- 依赖于带宽，包的大小
  
- 传播时延（propagation delay）
  - 从一个路由器传播1bit到另外一个路由器的时延
  - 是两台路由器之间距离以及物理介质的传播速率的函数

$$
d_{\text {nodal }}(总时延)=d_{\text {proc }}(处理时延)+d_{\text {queue }}(排队时延)+d_{\text {trans }}(传播时延)+d_{\text {prop }}(传输时延)
$$

#### 排队时延

令a为分组到达队列的平均速率（a单位为分组/秒）

令R为传输速率，即从队列中推出bit的速率（b/s）

令所有包大小为L比特

则*aL / R*为流量强度

当流量强度大于1时，排队时延就会接近无穷大（进入队列的速度比出去队列的速度快）

所以现实中一定要设计流量强度小于1的

包到达队列的过程通常是随机的，即分组之间的时间间隔是随机的

#### 丢包

排队容量极大地依赖于路由器的设计和成本

实际上，队列的容量是有限的

当流量强度趋近于1，路由器将丢弃即将到来的包

#### 吞吐量

平均吞吐量

- 指主机接收到该文件的速率

- 假设该文件由*F*bit
- 主机接收这*F*bit用了*T*秒
- 则该主机的平均吞吐量（average throughput）为*F/T*bps

例子

- 两条通信链路和一台路由器，R_s为服务器与路由器之间的链路速率，R_c为路由器与客户之间的链路速率，则吞吐量为
  $$
  \min \left|R_{\mathrm{c}}, R_{\mathrm{s}}\right|
  $$

- 就是说，这个是一个瓶颈链路（bottleneck link），即吞吐量取决于速率的较小值

- 同理，如果只有一个服务器和一个客户，两者之间由N条链路，其传输速率为

$$
R_{1}, R_{2}, \cdots, R_{N}
$$

则从服务器到客户的文件传输的吞吐量为
$$
\min \left\{R_{1}, R_{2}, \cdots, R_{N}\right\}
$$

- 今天因特网中对吞吐量的限制因素通常是接入网

### 协议层次及其服务模型

#### 分层的体系结构

服务模型

- 同一层向上一层提供服务

协议栈（protocol stack）

- 应用层
  - HTTP（提供Web文档）
  - SMTP（电子邮件的报文传输）
  - FTP（端系统之间的文件传输）
  - 可以自己写应用层协议（socket）
  - 应用层分组成为报文（message）
- 运输层
  - 运输应用层报文
  - TCP
    - 面向连接
    - 提供拥塞控制机制
  - UDP
    - 向应用程序提供无连接服务
    - 没有拥塞控制，没有可靠性
  - 分组成为报文段（segment）
- 网络层
  - 将数据报（datagram）的网络层分组从一台主机移动到另外一台
  - IP协议
  - 路由选择协议
- 链路层
  - 将数据报传递到下一个结点
  - 链路层分组成为帧（frame）

- 物理层
  - 将一个一个bit从一个结点移动到另外一个结点

#### 封装

链路层交换机

- 只实现了物理层和链路层协议
- 不能识别IP地址
- 但能识别以太网地址

路由器

- 实现了物理层，链路层和网络层协议
- 能识别IP协议

每一层对上一层都添加了属于自己的首部字段

##### 分层

优点

- 可以不管下面层次的改变

缺点

- 由于各个层是分开的，所以当一个层被优化时，整体可能没有被优化

### 网络安全

将malware放到主机中

- virus：需要用户的互动

- worm：只要接收到，就开始工作

spyware malware：记录所有包的传递（wireshark）

botnet：所有的客户端都被感染，形成的僵尸网络

Denial of Service：发送大量流量，削弱或者损坏服务器                                                                                                             

packet sniffing：监听所有包

IP spoofing：将src IP改成别的IP地址

### 网络历史

Kevinrock：提出了分组交换

Cerf and Kahn：互联网之父，发明了TCP/IP协议